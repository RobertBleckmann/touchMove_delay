{"ast":null,"code":"import { UserActionManager } from \"./user-action-manager\";\nimport { filter, withLatestFrom } from \"rxjs\";\nimport { EventType } from \"./models\";\nimport * as i0 from \"@angular/core\";\nexport class DrawDirective {\n  constructor(elementRef) {\n    this.elementRef = elementRef;\n    this.subscriptions = [];\n  }\n  ngAfterViewInit() {\n    this.activeEventType$.pipe(filter(eventType => !!eventType)).subscribe(eventType => {\n      eventType === EventType.PointerEvent ? this.addPointerEventListeners() : this.addTouchEventListeners();\n    });\n  }\n  addPointerEventListeners() {\n    this.unsubscribeAll(this.subscriptions);\n    this.subscriptions.push(UserActionManager.getPointerDownEvent(this.elementRef.nativeElement).subscribe(val => {\n      console.log(\"pointerDown\", val);\n      this.setStartOrEndPoint(val.x, val.y, 'red');\n    }));\n    this.subscriptions.push(UserActionManager.getPointerMoveEvent(this.elementRef.nativeElement).subscribe(val => {\n      console.log(\"pointerMove\", val);\n      this.drawOnCanvas(val.x, val.y, 'black');\n    }));\n    this.subscriptions.push(UserActionManager.getPointerUpEvent(this.elementRef.nativeElement).subscribe(val => {\n      console.log(\"pointerUp\", val);\n      this.setStartOrEndPoint(val.x, val.y, 'pink');\n    }));\n  }\n  addTouchEventListeners() {\n    this.unsubscribeAll(this.subscriptions);\n    this.subscriptions.push(UserActionManager.getTouchStartEvent(this.elementRef.nativeElement).subscribe(val => {\n      console.log(\"touchStart\", val);\n      this.setStartOrEndPoint(val.touches[0].clientX, val.touches[0].clientY, 'red');\n    }));\n    this.subscriptions.push(UserActionManager.getTouchMoveEvent(this.elementRef.nativeElement).subscribe(val => {\n      console.log(\"touchMove\", val);\n      this.drawOnCanvas(val.touches[0].clientX, val.touches[0].clientY, 'black');\n    }));\n    this.subscriptions.push(UserActionManager.getTouchEndEvent(this.elementRef.nativeElement).pipe(withLatestFrom(UserActionManager.getTouchMoveEvent(this.elementRef.nativeElement))).subscribe(([_, lastTouchMove]) => {\n      console.log(\"touchEnd\", lastTouchMove);\n      this.setStartOrEndPoint(lastTouchMove.touches[0].clientX, lastTouchMove.touches[0].clientY, 'pink');\n    }));\n  }\n  unsubscribeAll(subscriptions) {\n    subscriptions.forEach(sub => sub.unsubscribe());\n  }\n  setStartOrEndPoint(x, y, color) {\n    this.elementRef.nativeElement.fillStyle = color;\n    this.elementRef.nativeElement.fillRect(x, y, 3, 3);\n    this.lastCoordinates = {\n      lastX: x,\n      lastY: y\n    };\n  }\n  drawOnCanvas(x, y, color) {\n    this.elementRef.nativeElement.beginPath();\n    this.elementRef.nativeElement.moveTo(this.lastCoordinates.lastX, this.lastCoordinates.lastY);\n    this.elementRef.nativeElement.lineTo(x, y);\n    this.elementRef.nativeElement.strokeStyle = '#000000';\n    this.elementRef.nativeElement.stroke();\n    this.lastCoordinates = {\n      lastX: x,\n      lastY: y\n    };\n  }\n  static #_ = this.ɵfac = function DrawDirective_Factory(t) {\n    return new (t || DrawDirective)(i0.ɵɵdirectiveInject(i0.ElementRef));\n  };\n  static #_2 = this.ɵdir = /*@__PURE__*/i0.ɵɵdefineDirective({\n    type: DrawDirective,\n    selectors: [[\"\", \"draw\", \"\"]],\n    inputs: {\n      activeEventType$: \"activeEventType$\"\n    }\n  });\n}","map":{"version":3,"names":["UserActionManager","filter","withLatestFrom","EventType","DrawDirective","constructor","elementRef","subscriptions","ngAfterViewInit","activeEventType$","pipe","eventType","subscribe","PointerEvent","addPointerEventListeners","addTouchEventListeners","unsubscribeAll","push","getPointerDownEvent","nativeElement","val","console","log","setStartOrEndPoint","x","y","getPointerMoveEvent","drawOnCanvas","getPointerUpEvent","getTouchStartEvent","touches","clientX","clientY","getTouchMoveEvent","getTouchEndEvent","_","lastTouchMove","forEach","sub","unsubscribe","color","fillStyle","fillRect","lastCoordinates","lastX","lastY","beginPath","moveTo","lineTo","strokeStyle","stroke","i0","ɵɵdirectiveInject","ElementRef","_2","selectors","inputs"],"sources":["C:\\Workspace\\touchMove_delay\\src\\app\\draw.directive.ts"],"sourcesContent":["import {AfterViewInit, Directive, ElementRef, Input, OnInit} from \"@angular/core\";\r\nimport {UserActionManager} from \"./user-action-manager\";\r\nimport {filter, Observable, Subscription, withLatestFrom} from \"rxjs\";\r\nimport {LastCoordinates} from \"./app.component\";\r\nimport {EventType} from \"./models\";\r\n\r\n@Directive({\r\n    selector: \"[draw]\"\r\n})\r\nexport class DrawDirective implements AfterViewInit {\r\n\r\n    @Input()\r\n    public activeEventType$: Observable<EventType>;\r\n\r\n    private subscriptions: Subscription[] = [];\r\n    private lastCoordinates: LastCoordinates;\r\n\r\n    constructor(\r\n        private readonly elementRef: ElementRef\r\n    ) {\r\n\r\n    }\r\n\r\n    ngAfterViewInit() {\r\n        this.activeEventType$.pipe(filter(eventType => !!eventType)).subscribe((eventType: EventType) => {\r\n            eventType === EventType.PointerEvent\r\n                ? this.addPointerEventListeners()\r\n                : this.addTouchEventListeners();\r\n        })\r\n    }\r\n\r\n    private addPointerEventListeners() {\r\n        this.unsubscribeAll(this.subscriptions);\r\n        this.subscriptions.push(\r\n            UserActionManager.getPointerDownEvent(this.elementRef.nativeElement).subscribe(\r\n                val => {\r\n                    console.log(\"pointerDown\", val);\r\n                    this.setStartOrEndPoint(val.x, val.y, 'red');\r\n                }\r\n            )\r\n        )\r\n\r\n        this.subscriptions.push(\r\n            UserActionManager.getPointerMoveEvent(this.elementRef.nativeElement).subscribe(\r\n                val => {\r\n                    console.log(\"pointerMove\", val);\r\n                    this.drawOnCanvas(val.x, val.y, 'black');\r\n                }\r\n            )\r\n        )\r\n\r\n        this.subscriptions.push(\r\n            UserActionManager.getPointerUpEvent(this.elementRef.nativeElement).subscribe(\r\n                val => {\r\n                    console.log(\"pointerUp\", val);\r\n                    this.setStartOrEndPoint(val.x, val.y, 'pink');\r\n                }\r\n            )\r\n        )\r\n    }\r\n\r\n    private addTouchEventListeners(): void {\r\n        this.unsubscribeAll(this.subscriptions);\r\n        this.subscriptions.push(\r\n            UserActionManager.getTouchStartEvent(this.elementRef.nativeElement).subscribe(\r\n                val => {\r\n                    console.log(\"touchStart\", val);\r\n                    this.setStartOrEndPoint(val.touches[0].clientX, val.touches[0].clientY, 'red');\r\n                }\r\n            )\r\n        )\r\n\r\n        this.subscriptions.push(\r\n            UserActionManager.getTouchMoveEvent(this.elementRef.nativeElement).subscribe(\r\n                val => {\r\n                    console.log(\"touchMove\", val);\r\n                    this.drawOnCanvas(val.touches[0].clientX, val.touches[0].clientY, 'black');\r\n                }\r\n            )\r\n        )\r\n\r\n        this.subscriptions.push(\r\n            UserActionManager.getTouchEndEvent(this.elementRef.nativeElement).pipe(withLatestFrom(UserActionManager.getTouchMoveEvent(this.elementRef.nativeElement))).subscribe(\r\n                ([_, lastTouchMove]) => {\r\n                    console.log(\"touchEnd\", lastTouchMove);\r\n                    this.setStartOrEndPoint(lastTouchMove.touches[0].clientX, lastTouchMove.touches[0].clientY, 'pink');\r\n                }\r\n            )\r\n        )\r\n    }\r\n\r\n    private unsubscribeAll(subscriptions: Subscription[]) {\r\n        subscriptions.forEach(sub => sub.unsubscribe())\r\n    }\r\n\r\n    private setStartOrEndPoint(x: number, y: number, color: string) {\r\n        this.elementRef.nativeElement.fillStyle = color;\r\n        this.elementRef.nativeElement.fillRect(x, y, 3, 3);\r\n        this.lastCoordinates = { lastX: x, lastY: y };\r\n    }\r\n\r\n    private drawOnCanvas(x: number, y: number, color: string) {\r\n        this.elementRef.nativeElement.beginPath();\r\n        this.elementRef.nativeElement.moveTo(\r\n            this.lastCoordinates.lastX,\r\n            this.lastCoordinates.lastY\r\n        );\r\n        this.elementRef.nativeElement.lineTo(x, y);\r\n        this.elementRef.nativeElement.strokeStyle = '#000000';\r\n        this.elementRef.nativeElement.stroke();\r\n\r\n        this.lastCoordinates = { lastX: x, lastY: y };\r\n    }\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}